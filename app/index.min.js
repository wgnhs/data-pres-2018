!(function(t){"function"==typeof define&&define.amd?define(t):t()})(function(){"use strict";const t=L.CircleMarker.extend({getEvents:function(){return{zoomend:this._restyle,filterpoints:this._filter}},_restyle:function(e){this.setRadius(t.calcRadius(e.target.getZoom()))},_filter:function(t){t.detail.resolve(this.feature.properties)?this.setStyle({stroke:!0,fill:!0}):this.setStyle({stroke:!1,fill:!1})},highlight:function(){this._activeBackup=this.options.color,this.setStyle({color:"orange"})},removeHighlight:function(){this._activeBackup&&(this.setStyle({color:this._activeBackup}),this._activeBackup=null)}});t.calcRadius=(t=>Math.max(t/1.5,3));class e extends window.L.Evented{constructor(){super(),this.selected=!1,this._highlight=null;const i=this.map=L.map("map",{zoomControl:!1}).setView([45,-89.623861],7);this.el=document.querySelector("#map"),new L.Control.Zoom({position:"topright"}).addTo(i);var o=[L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',label:"OpenStreetMap Humanitarian"}).addTo(i),L.esri.basemapLayer("Imagery",{label:"Esri Satellite"})];i.addControl(L.control.basemaps({basemaps:o,tileX:0,tileY:0,tileZ:1}));let r=this.bore=L.esri.featureLayer({url:"https://data.wgnhs.wisc.edu/arcgis/rest/services/geologic_data/borehole_geophysics/MapServer/0",pointToLayer:function(e,o){return new t(o,{weight:2,radius:t.calcRadius(i.getZoom())})}}).on("click",function(t){this._highlight!==t.propagatedFrom?this.fire("interaction",t.propagatedFrom.feature.properties):this.fire("interaction")}.bind(this)),n=this.quat=L.esri.featureLayer({url:"https://data.wgnhs.wisc.edu/arcgis/rest/services/geologic_data/sediment_core/MapServer/0",pointToLayer:function(e,o){return new t(o,{weight:2,color:"#33AA44",radius:t.calcRadius(i.getZoom())})}}).on("click",function(t){this._highlight!==t.propagatedFrom?this.fire("interaction",t.propagatedFrom.feature.properties):this.fire("interaction")}.bind(this));this.layers=[r,n],Promise.all([new Promise(function(t,e){r.once("load",function(){t()})}),new Promise(function(t,e){n.once("load",function(){t()})})]).then(function(){let t={};this.layers.forEach(function(i){i.eachFeature(function(i){t[e.getSiteCode(i.feature.properties)]=i})}),this._lookup=t,this.fire("init")}.bind(this)),r.addTo(i),n.addTo(i)}static getSiteCode(t){return["Wid","ID","Site_Code"].reduce((e,i)=>e||t[i],void 0)}getPoint(t){return this._lookup[e.getSiteCode(t)]}zoomToPoint(t){let e=this.getPoint(t);e&&this.map.setZoomAround(e.getLatLng(),15)}getHighlightPoint(){return this._highlight}setHighlightPoint(t){t?(this._highlight=t,this._highlight.bringToFront(),this._highlight.highlight()):this.clearSelection()}selectPoint(t){let e=null,i=this.getPoint(t);if(i){e=i.feature.properties,i!==this.getHighlightPoint()&&(this.clearSelection(),this.setHighlightPoint(i))}return e}clearSelection(){this._highlight&&(this._highlight.bringToBack(),this._highlight.removeHighlight()),this._highlight=null}setVisibility(t){t?(this.el.removeAttribute("data-closed"),this.map.invalidateSize()):this.el.setAttribute("data-closed",!0)}}class i{constructor(...t){this._aggrKeys=[],this.aggrData=[];for(let e of t)this.aggrData.push(i._gatherAggrData(e,this._aggrKeys))}static _gatherAggrData(t,e){const i={aggr:{},data:[]};return t.eachFeature(function(t,o){let r={};e.forEach(function(e){r[e]=t.feature.properties[e],i.aggr[e]||(i.aggr[e]={}),r[e]&&"number"==typeof r[e]&&((!i.aggr[e].max||i.aggr[e].max<r[e])&&(i.aggr[e].max=r[e]),(!i.aggr[e].min||i.aggr[e].min>r[e])&&(i.aggr[e].min=r[e]))}),i.data.push(r)}),i}}class o extends window.L.Evented{constructor(){super();let t=this.router=new Navigo(window.location.origin+"/data-pres-2018/");Object.entries(this.route).forEach(function(e){e[1].signature?t.on(e[1].signature,e[1].handler):t.notFound(e[1].handler)})}resolve(){this.router.resolve()}get route(){return{entry:{handler:this._entryRoute.bind(this)},view:{signature:"/view/:Site_Code",handler:this._viewSite.bind(this)},print:{signature:"/print/:Site_Code",handler:this._printSite.bind(this)}}}static getSiteCode(t){return["Wid","ID","Site_Code"].reduce((e,i)=>e||t[i],void 0)}_updateLocation(t){this.router.pause(),this.router.navigate(t),this.router.resume()}_entryRoute(){this._updateLocation("/"),this.fire("route-entry")}_viewSite(t){let e=o.getSiteCode(t);e?(this._updateLocation("/view/"+e),this.fire("route-view",t)):console.error("bad viewSite call")}_printSite(t){let e=o.getSiteCode(t);e?(this._updateLocation("/print/"+e),this.fire("route-print",t)):console.error("bad printSite call")}clearRoute(){this.setRoute()}setRoute(t,e){arguments.length>0&&this.route[t]?this.route[t].handler(e):this._entryRoute()}}window.siteMap=new e,window.sidebar=document.querySelector("#sidebar"),window.siteMap.once("init",function(){window.siteData=new i(window.siteMap.bore,window.siteMap.quat),window.aggrData=siteData.aggrData;var t=function(){document.dispatchEvent(new CustomEvent("toggle-pdf",{bubbles:!0,detail:{closed:!0}})),document.querySelectorAll("site-details").forEach(function(t){t.siteinfo=null}),document.querySelectorAll("pdf-view").forEach(function(t){t.pdfsrc=null})};async function e(e){return t(),document.querySelectorAll("site-details").forEach(function(t){t.siteinfo=e}),document.querySelectorAll("pdf-view").forEach(function(t){t.pdfsrc=e.Wid?"https://data.wgnhs.wisc.edu/geophysical-logs/"+e.Wid+".pdf":null}),!0}window.router=new o,window.router.on("route-entry",()=>{window.siteMap.clearSelection(),t(),document.querySelector("#app").setAttribute("data-view","app"),window.sidebar.switchTab("default"),window.siteMap.setVisibility(!0)}),window.router.on("route-view",t=>{let i=window.siteMap.selectPoint(t);i?(document.querySelectorAll("site-details").forEach(function(t){t.printLayout=!1}),e(i).then(()=>{document.querySelector("#app").setAttribute("data-view","app"),window.sidebar.switchTab("details"),window.siteMap.setVisibility(!0)})):window.router.clearRoute()}),window.router.on("route-print",t=>{let i=window.siteMap.selectPoint(t);i?(document.querySelectorAll("site-details").forEach(function(t){t.printLayout=!0}),e(i).then(()=>{document.querySelector("#app").removeAttribute("data-view"),window.sidebar.switchTab("details"),window.siteMap.setVisibility(!1)})):window.router.clearRoute()}),window.router.resolve(),window.siteMap.on("interaction",t=>{o.getSiteCode(t)?window.router.setRoute("view",t):window.router.clearRoute()})}),document.addEventListener("clear-selection",function(t){window.router.clearRoute()}),document.addEventListener("toggle-print",function(t){t.detail.on?window.router.setRoute("print",t.detail.params):window.router.setRoute("view",t.detail.params)}),document.addEventListener("toggle-pdf",function(t){window.siteMap.setVisibility(t.detail.closed)})});
//# sourceMappingURL=index.min.js.map
