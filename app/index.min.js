!(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("lit-element"),require("@uirouter/core")):"function"==typeof define&&define.amd?define(["lit-element","@uirouter/core"],e):e((t=t||self).common,t.common)})(this,function(t,e){"use strict";const i=L.CircleMarker.extend({getEvents:function(){return{zoomend:this._restyle,filterpoints:this._filter}},_restyle:function(t){this.setRadius(i.calcRadius(t.target.getZoom()))},_filter:function(t){t.detail.resolve(this.feature.properties)?this.setStyle({stroke:!0,fill:!0}):this.setStyle({stroke:!1,fill:!1})},highlight:function(){this._activeBackup={color:this.options.color,stroke:this.options.stroke,fill:this.options.fill},this.setStyle({color:"var(--palette-active)",stroke:!0,fill:!0})},removeHighlight:function(){this._activeBackup&&(this.setStyle(this._activeBackup),this._activeBackup=null)}});i.calcRadius=(t=>Math.max(t/1.5,3));class o extends window.L.Evented{constructor(){super(),this.selected=!1,this._highlight=null;const t=this.map=L.map("map",{zoomControl:!1}).setView([45,-89.623861],7);this.el=document.querySelector("#map"),new L.Control.Zoom({position:"topright"}).addTo(t);var e=[L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',label:"OpenStreetMap Humanitarian"}).addTo(t),L.esri.basemapLayer("Imagery",{label:"Esri Satellite"})];t.addControl(L.control.basemaps({basemaps:e,tileX:0,tileY:0,tileZ:1}));let r=this.bore=L.esri.featureLayer({name:"Geophysical Log Data",url:"https://data.wgnhs.wisc.edu/arcgis/rest/services/geologic_data/borehole_geophysics/MapServer/0",pointToLayer:function(e,o){return new i(o,{weight:2,color:"var(--palette-blue)",radius:i.calcRadius(t.getZoom()),stroke:!1,fill:!1})}}).on("click",function(t){this._highlight!==t.propagatedFrom?this.fire("interaction",t.propagatedFrom.feature.properties):this.fire("interaction")}.bind(this)),n=this.quat=L.esri.featureLayer({name:"Quaternary Core Data",url:"https://data.wgnhs.wisc.edu/arcgis/rest/services/geologic_data/sediment_core/MapServer/0",pointToLayer:function(e,o){return new i(o,{weight:2,color:"var(--palette-green)",radius:i.calcRadius(t.getZoom()),stroke:!1,fill:!1})}}).on("click",function(t){this._highlight!==t.propagatedFrom?this.fire("interaction",t.propagatedFrom.feature.properties):this.fire("interaction")}.bind(this));this.layers=[r,n],Promise.all([new Promise(function(t,e){r.once("load",function(){t()})}),new Promise(function(t,e){n.once("load",function(){t()})})]).then(()=>{let t={};this.layers.forEach(function(e,i,r){e.eachFeature(function(n){let s=n.feature.properties.Wid,a=o.getSiteCode(n.feature.properties),l=n.feature.properties.Site_Name||n.feature.properties.SiteName,u=n.getLatLng(),c=t[a]||{Site_Code:a,Site_Name:l,Wid:s,Latitude:u.lat,Longitude:u.lng,point:n,datas:new Array(r.length)};n.feature.properties.Site_Code=a,n.feature.properties.Data_Type=e.options.name,c.datas[i]=n.feature.properties,t[a]=c})}),this._lookup=t,this.fire("init")}),r.addTo(t),n.addTo(t)}static getSiteCode(t){return["Wid","ID","Site_Code"].reduce((e,i)=>e||t[i],void 0)}getPoint(t){let e=null,i=this._lookup[o.getSiteCode(t)];return i&&(e=i.point),e}getSite(t){return this._lookup[o.getSiteCode(t)]}zoomToPoint(t){let e=this.getPoint(t);e&&this.map.setZoomAround(e.getLatLng(),15)}getHighlightPoint(){return this._highlight}setHighlightPoint(t){t?(this._highlight=t,this._highlight.bringToFront(),this._highlight.highlight()):this.clearSelection()}selectPoint(t){let e=null,i=this.getPoint(t);if(i){e=i.feature.properties,i!==this.getHighlightPoint()&&(this.clearSelection(),this.setHighlightPoint(i))}return e}selectSite(t){let e=this.getSite(t);return this.selectPoint(t),e}clearSelection(){this._highlight&&(this._highlight.bringToBack(),this._highlight.removeHighlight()),this._highlight=null}updatePoints(t){this.map.fire("filterpoints",{detail:{resolve:e=>t.reduce((t,i)=>{const r=o.getSiteCode(e),n=i.has(""+r);return t||n},!1)}})}setVisibility(t){t?(this.el.removeAttribute("data-closed"),this.map.invalidateSize()):this.el.setAttribute("data-closed",!0)}}function r(){return"_"+Math.random().toString(36).substr(2,9)}class n{constructor(t){Object.assign(this,t),this.id||(this.id=r())}activate(t){let e=null;const i=t.detail.checked;return t.toggleable&&i&&(e={id:t.id,resolve:function(e){return e[t.prop]===t.value}}),e}}class s{constructor(){this.id=r()}get next(){return t.html`
      <input type="checkbox">
    `}handle(t){let e=null;return t.target.nextElementSibling.checked&&(e={id:t.id,resolveGroup:function(e){return!t.group.prop||t.group[t.group.prop]===e[t.group.prop]},resolve:function(e){return!!e[t.prop]}}),e}}class a{constructor(t){this.id=r(),this.gtName=t?"after":"at least",this.ltName=t?"before":"less than"}get next(){return t.html`
      <select>
        <option value="gt">${this.gtName}</option>
        <option value="lt">${this.ltName}</option>
      </select>
      <input type="text">
    `}handle(t){let e=null;t.gt=((t,e)=>t>=e),t.lt=((t,e)=>t<e);const i=t[t.target.nextElementSibling.value],o=t.target.nextElementSibling.nextElementSibling.value;return o&&(e={id:t.id,resolveGroup:function(e){return!t.group.prop||t.group[t.group.prop]===e[t.group.prop]},resolve:function(e){let r=!!e[t.prop];return r&&(r=i(e[t.prop],o)),r}}),e}}class l{constructor(){this.id=r()}get next(){return t.html`
      <select ?disabled="${!this.options}">
        <option></option>
        ${this.options?this.options.map(e=>t.html`
        <option value="${e}">${e}</option>
        `):""}
      </select>
    `}init(t){this.options||(this.options=Array.from(t).sort())}handle(t){let e=null;const i=t.target.nextElementSibling.value;return i&&(e={id:t.id,resolveGroup:function(e){return!t.group.prop||t.group[t.group.prop]===e[t.group.prop]},resolve:function(e){let o=!!e[t.prop];if(o){o=e[t.prop]===i}return o}}),e}}class u{constructor(t){this._aggrKeys=["County","Drill_Meth"],this.aggrData=[];for(let e of t)this.aggrData.push(u._gatherAggrData(e,this._aggrKeys));this.datas=this.aggrData.map(t=>t.data).reduce((t,e)=>t.concat(e),[]),this.uniques={},this._aggrKeys.forEach(t=>this.uniques[t]=new Set(this.datas.map(e=>e[t]).filter(t=>!!t)))}static _gatherAggrData(t,e){const i={aggr:{},data:[]};return t.eachFeature(function(t,o){let r={};e.forEach(function(e){r[e]=t.feature.properties[e],i.aggr[e]||(i.aggr[e]={});let o=i.aggr[e];r[e]&&"number"==typeof r[e]&&((!o.max||o.max<r[e])&&(o.max=r[e]),(!o.min||o.min>r[e])&&(o.min=r[e]))}),i.data.push(r)}),i}}new n({title:"Site Information",open:!0,sections:[{fields:{County:{controls:[new l]},Site_Name:{controls:[new class{constructor(){this.id=r()}get next(){return t.html`
      <input type="text">
    `}handle(t){let e=null;const i=(""+t.target.nextElementSibling.value).trim().toUpperCase();return i&&(e={id:t.id,resolveGroup:function(e){return!t.group.prop||t.group[t.group.prop]===e[t.group.prop]},resolve:function(e){let o=!!e[t.prop];return o&&(o=(""+e[t.prop]).trim().toUpperCase().includes(i)),o}}),e}}]},Wid:{controls:[new class{constructor(){this.id=r()}get next(){return t.html`
      <input type="text">
    `}handle(t){let e=null;const i=(""+t.target.nextElementSibling.value).trim().toUpperCase();return i&&(e={id:t.id,resolveGroup:function(e){return!t.group.prop||t.group[t.group.prop]===e[t.group.prop]},resolve:function(e){let o=!!e[t.prop];return o&&(o=(""+e[t.prop]).trim().toUpperCase()===i),o}}),e}}]}}}]}),new n({title:"Geophysical Log Data",prop:"Data_Type",Data_Type:"Geophysical Log Data",toggleable:!0,active:!0,sections:[{fields:{RecentLog:{controls:[new a(!0)]},MaxDepth:{controls:[new a]}}},{title:"Geologic",fields:{Norm_Res:{controls:[new s]},Caliper:{controls:[new s]},Gamma:{controls:[new s]},SP:{controls:[new s]},SPR:{controls:[new s]},Spec_Gamma:{controls:[new s]}}},{title:"Hydrogeologic",fields:{Fluid_Cond:{controls:[new s]},Flow_Spin:{controls:[new s]},Fluid_Temp:{controls:[new s]},Fluid_Res:{controls:[new s]},Flow_HP:{controls:[new s]}}},{title:"Image",fields:{OBI:{controls:[new s]},ABI:{controls:[new s]},Video:{controls:[new s]}}}]}),new n({title:"Quaternary Core Data",prop:"Data_Type",Data_Type:"Quaternary Core Data",toggleable:!0,active:!0,sections:[{fields:{Drill_Year:{controls:[new a(!0)]},Depth_Ft:{controls:[new a]},Drill_Meth:{controls:[new l]}}},{title:"Analyses available",fields:{Subsamples:{controls:[new s]},Photos:{controls:[new s]},Grainsize:{controls:[new s]}}}]});const c="entry";window.siteMap=new o,window.sidebar=document.querySelector("#sidebar"),window.pdfPanel=document.querySelector("#sketch"),document.querySelectorAll("site-details").forEach(function(t){t.pdfpanel=window.pdfPanel}),window.filter=document.querySelector("#filter"),window.siteMap.once("init",function(){window.siteData=new u(window.siteMap.layers),window.aggrData=siteData.aggrData,filter.init(window.siteData.uniques,window.siteMap.layers);var t=function(){window.pdfPanel.hide(),document.querySelectorAll("site-details").forEach(function(t){t.siteinfo=null})};async function i(e){return t(),document.querySelectorAll("site-details").forEach(function(t){t.siteinfo=e}),!0}window.router=new class extends window.L.Evented{constructor(){super(),this.router=new e.UIRouter,this.router.plugin(e.pushStateLocationPlugin),this.router.plugin(e.servicesPlugin),this.routes={}}start(){this.router.urlService.rules.initial({state:c}),this.router.urlService.rules.otherwise({state:c}),this.router.urlService.listen(),this.router.urlService.sync()}addRoute(t){t&&t.name&&(this.routes[t.name]=t,this.router.stateRegistry.register(t))}clearRoute(){this.setRoute()}setRoute(t,e){arguments.length>0&&this.routes[t]?this.router.stateService.go(t,e):this.router.stateService.go(c)}link(t,e){let i="";return i=e?this.router.stateService.href(t,e):this.router.stateService.href(t)}},window.router.addRoute({name:"entry",url:"/",onEnter:function(e,i){window.siteMap.clearSelection(),t(),document.querySelector("#app").setAttribute("data-view","app"),window.sidebar.switchTab("default"),window.siteMap.setVisibility(!0)},onExit:function(t,e){}}),window.router.addRoute({name:"view",url:"/view/:Site_Code",onEnter:function(t,e){let o=t.params(),r=window.siteMap.selectSite(o);r?(document.querySelectorAll("site-details").forEach(function(t){t.printLayout=!1}),i(r).then(()=>{document.querySelector("#app").setAttribute("data-view","app"),window.sidebar.switchTab("details"),window.siteMap.setVisibility(!0)})):window.router.clearRoute()},onExit:function(t,e){}}),window.router.addRoute({name:"print",url:"/print/:Site_Code",onEnter:function(t,e){let o=t.params(),r=window.siteMap.selectSite(o);r?(document.querySelectorAll("site-details").forEach(function(t){t.printLayout=!0}),i(r).then(()=>{document.querySelector("#app").removeAttribute("data-view"),window.sidebar.switchTab("details"),window.siteMap.setVisibility(!1)})):window.router.clearRoute()},onExit:function(t,e){}}),window.router.router.transitionService.onEnter({},()=>{document.querySelector("#spinner").setAttribute("data-closed",!0)}),window.router.start(),window.siteMap.on("interaction",t=>{t.Site_Code?window.router.setRoute("view",t):window.router.clearRoute()})}),document.addEventListener("clear-selection",function(t){window.router.clearRoute()}),document.addEventListener("toggle-print",function(t){t.detail.on?window.router.setRoute("print",t.detail.params):window.router.setRoute("view",t.detail.params)}),document.addEventListener("toggle-pdf-panel",function(t){window.siteMap.setVisibility(t.detail.closed)}),window.filter.addEventListener("filtered",function(t){window.siteMap.updatePoints(t.detail.activePoints)})});
//# sourceMappingURL=index.min.js.map
