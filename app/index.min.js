!(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("lit-element"),require("wgnhs-common"),require("wgnhs-router"),require("wgnhs-styles"),require("wgnhs-pdf"),require("wgnhs-layout")):"function"==typeof define&&define.amd?define(["exports","lit-element","wgnhs-common","wgnhs-router","wgnhs-styles","wgnhs-pdf","wgnhs-layout"],t):t((e=e||self).app={},e["wgnhs-common"],e["wgnhs-common"],e["wgnhs-router"],e["wgnhs-common"],e["wgnhs-pdf"],e["wgnhs-layout"])})(this,function(e,t,i,o,r,s,n){"use strict";class l{constructor(e){Object.assign(this,e),this.id||(this.id=i.genId())}activate(e){let t=null;const i=e.detail.checked;return e.toggleable&&i&&(t={id:e.id,context:e,resolve:function(t){return t[e.prop]===e.value}}),t}}class a{constructor(){this.id=i.genId()}get next(){return t.html`<input type=checkbox>`}handle(e){let t=null;return e.target.nextElementSibling.checked&&(t={id:e.id,context:e,resolveGroup:function(t){return!e.group.prop||e.group[e.group.prop]===t[e.group.prop]},resolve:function(t){return!!t[e.prop]}}),t}}class c{constructor(e){this.id=i.genId(),this.gtName=e?"after":"at least",this.eqName=e?"exactly":"equal to",this.ltName=e?"before":"less than"}get next(){return t.html`<select><option value=gt>${this.gtName}</option><option value=eq>${this.eqName}</option><option value=lt>${this.ltName}</option></select> <input type=text>`}handle(e){let t=null;e.gt=((e,t)=>e>=t),e.eq=((e,t)=>e==t),e.lt=((e,t)=>e<t);const i=e[e.target.nextElementSibling.value],o=e.target.nextElementSibling.nextElementSibling.value;return o&&(t={id:e.id,context:e,resolveGroup:function(t){return!e.group.prop||e.group[e.group.prop]===t[e.group.prop]},resolve:function(t){let r=!!t[e.prop];return r&&(r=i(t[e.prop],o)),r}}),t}}class d{constructor(){this.id=i.genId()}get next(){return t.html`<select ?disabled=${!this.options}><option></option>${this.options?this.options.map(e=>t.html`<option value=${e}>${e}</option>`):""}</select>`}init(e){this.options||(this.options=Array.from(e).sort())}handle(e){let t=null;const i=e.target.nextElementSibling.value;return i&&(t={id:e.id,context:e,resolveGroup:function(t){return!e.group.prop||e.group[e.group.prop]===t[e.group.prop]},resolve:function(t){let o=!!t[e.prop];if(o){o=t[e.prop]===i}return o}}),t}}class u{constructor(e){this._aggrKeys=["County","Drill_Method","Project"],this.aggrData=[];for(let t of e)this.aggrData.push(u._gatherAggrData(t,this._aggrKeys));this.datas=this.aggrData.map(e=>e.data).reduce((e,t)=>e.concat(t),[]),this.uniques={},this._aggrKeys.forEach(e=>this.uniques[e]=new Set(this.datas.map(t=>t[e]).filter(e=>!!e)))}static _gatherAggrData(e,t){const i={aggr:{},data:[]};return e.eachLayer(function(e,o){let r={};t.forEach(function(t){r[t]=e.feature.properties[t],i.aggr[t]||(i.aggr[t]={});let o=i.aggr[t];r[t]&&"number"==typeof r[t]&&((!o.max||o.max<r[t])&&(o.max=r[t]),(!o.min||o.min>r[t])&&(o.min=r[t]))}),i.data.push(r)}),i}}const p=["Site_Code","Data_Type","SiteName","Site_Name","Wid","ID","County"],h={Site_Name:{title:"Name",desc:""},Wid:{title:"WGNHS ID",desc:""},WID:{title:"WGNHS ID",desc:""},RecentLog:{title:"Most recent log (year)",desc:""},MaxDepth:{title:"Max depth (ft)",desc:""},Norm_Res:{title:"Normal Resistivity",desc:""},Caliper:{title:"Caliper",desc:""},Gamma:{title:"Natural Gamma",desc:""},SP:{title:"Spontaneous (Self) Potential",desc:""},SPR:{title:"Single Point Resistivity",desc:""},Spec_Gamma:{title:"Spectral Gamma",desc:""},Fluid_Cond:{title:"Fluid Conductivity",desc:""},Flow_Spin:{title:"Spinner Flow Meter",desc:""},Flow_HP:{title:"HeatPulse Flow Meter",desc:""},Fluid_Temp:{title:"Fluid Temperature",desc:""},Fluid_Res:{title:"Fluid Resistivity",desc:""},OBI:{title:"Optical Borehole Image (OBI)",desc:""},ABI:{title:"Acoustic Borehole Image (ABI)",desc:""},Video:{title:"Video",desc:""},Field_ID:{title:"Field ID",desc:""},Project:{title:"Project",desc:""},Drill_Year:{title:"Drill year",desc:""},Depth_Ft:{title:"Depth (ft)",desc:""},Drill_Method:{title:"Drill Method",desc:""},Subsamples:{title:"Subsamples",desc:""},Photos:{title:"Core Photos",desc:""},Grainsize:{title:"Grainsize",desc:""},Age_Data:{title:"Age data",desc:""},Proxy_Data:{title:"Proxy data",desc:""}},g=[new l({title:"Site information",open:!0,sections:[{fields:{County:{controls:[new d]},Site_Name:{controls:[new class{constructor(){this.id=i.genId()}get next(){return t.html`<input type=text>`}handle(e){let t=null;const i=(""+e.target.nextElementSibling.value).trim().toUpperCase();return i&&(t={id:e.id,context:e,resolveGroup:function(t){return!e.group.prop||e.group[e.group.prop]===t[e.group.prop]},resolve:function(t){let o=!!t[e.prop];return o&&(o=(""+t[e.prop]).trim().toUpperCase().includes(i)),o}}),t}}]},Wid:{controls:[new class{constructor(){this.id=i.genId()}get next(){return t.html`<input type=text>`}handle(e){let t=null;const i=(""+e.target.nextElementSibling.value).trim().toUpperCase();return i&&(t={id:e.id,context:e,resolveGroup:function(t){return!e.group.prop||e.group[e.group.prop]===t[e.group.prop]},resolve:function(t){let o=!!t[e.prop];return o&&(o=(""+t[e.prop]).trim().toUpperCase()===i),o}}),t}}]}}}]}),new l({title:"Geophysical Log data",prop:"Data_Type",Data_Type:"geophysical log",source:{geojson:"https://data.wgnhs.wisc.edu/arcgis/rest/services/geologic_data/borehole_geophysics/MapServer/0/query?where=1%3D1&inSR=4326&outFields=*&returnGeometry=true&geometryPrecision=6&outSR=4326&f=geojson",user:"https://data.wgnhs.wisc.edu/arcgis/rest/services/geologic_data/borehole_geophysics/MapServer/0"},color:"var(--map-symbol-0)",toggleable:!0,active:!0,sections:[{fields:{RecentLog:{controls:[new c(!0)]},MaxDepth:{controls:[new c]}}},{title:"Geologic",bundled:!0,fields:{Norm_Res:{controls:[new a]},Caliper:{controls:[new a]},Gamma:{controls:[new a]},SP:{controls:[new a]},SPR:{controls:[new a]},Spec_Gamma:{controls:[new a]}}},{title:"Hydrogeologic",bundled:!0,fields:{Fluid_Cond:{controls:[new a]},Flow_Spin:{controls:[new a]},Fluid_Temp:{controls:[new a]},Fluid_Res:{controls:[new a]},Flow_HP:{controls:[new a]}}},{title:"Image",bundled:!0,fields:{OBI:{controls:[new a]},ABI:{controls:[new a]},Video:{controls:[new a]}}}]}),new l({title:"Quaternary Core data",prop:"Data_Type",Data_Type:"quaternary core",source:{geojson:"https://data.wgnhs.wisc.edu/arcgis/rest/services/geologic_data/sediment_core/MapServer/0/query?where=1%3D1&inSR=4326&outFields=*&returnGeometry=true&geometryPrecision=6&outSR=4326&f=geojson",user:"https://data.wgnhs.wisc.edu/arcgis/rest/services/geologic_data/sediment_core/MapServer/0"},color:"var(--map-symbol-1)",toggleable:!0,active:!0,sections:[{fields:{Drill_Year:{controls:[new c(!0)]},Project:{controls:[new d]},Depth_Ft:{controls:[new c]},Drill_Method:{controls:[new d]}}},{title:"Analyses available",bundled:!0,fields:{Subsamples:{controls:[new a]},Photos:{controls:[new a]},Grainsize:{controls:[new a]},Age_Data:{controls:[new a]}}}]})],m=L.CircleMarker.extend({getEvents:function(){return{zoomend:this._restyle,filterpoints:this._filter}},_restyle:function(e){this.setRadius(m.calcRadius(e.target.getZoom()))},_filter:function(e){e.detail.resolve(this.feature.properties)?this.setStyle({stroke:!0,fill:!0}):this.setStyle({stroke:!1,fill:!1})},highlight:function(){this._activeBackup={color:this.options.color,stroke:this.options.stroke,fill:this.options.fill},this.setStyle({color:"var(--map-symbol-active)",stroke:!0,fill:!0})},removeHighlight:function(){this._activeBackup&&(this.setStyle(this._activeBackup),this._activeBackup=null)}});m.calcRadius=(e=>Math.max(Math.floor(e/1.5),3));class f extends window.L.Evented{constructor(){super(),this.selected=!1,this._highlight=null;const e=this.map=L.map("map",{zoomControl:!1}).setView([44.25,-89.9],7);this.el=document.querySelector("#map"),new L.Control.Zoom({position:"topright"}).addTo(e);var t=[L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attributions">CARTO</a>',label:"CARTO Voyager"}),L.esri.basemapLayer("Imagery",{label:"Esri Satellite"})];t[0].addTo(e),e.addControl(L.control.basemaps({basemaps:t,tileX:0,tileY:0,tileZ:1}));let i=g.reduce((e,t)=>(t.source&&t.source.geojson&&e.push(window.fetch(t.source.geojson).then(e=>e.json()).then(e=>({name:t[t.prop],color:t.color,data:e}))),e),[]);Promise.all(i).then(t=>{this.layers=t.map(t=>L.geoJSON(t.data,{name:t.name,pointToLayer:function(i,o){return new m(o,{weight:2,color:t.color,radius:m.calcRadius(e.getZoom()),stroke:!1,fill:!1})}})),this.layers.forEach(e=>e.on("click",e=>{this._highlight!==e.propagatedFrom?this.fire("interaction",e.propagatedFrom.feature.properties):this.fire("interaction")})),this.layers.forEach(t=>t.addTo(e));let i={};this.layers.forEach(function(e,t,o){e.eachLayer(function(r){let s=r.feature.properties.Wid||r.feature.properties.WGNHS_ID,n=f.getSiteCode(r.feature.properties),l=r.feature.properties.Site_Name||r.feature.properties.SiteName,a=r.getLatLng(),c=i[n]||{Site_Code:n,Site_Name:l,Wid:s,Latitude:a.lat.toFixed(6),Longitude:a.lng.toFixed(6),point:r,datas:new Array(o.length)};r.feature.properties.Site_Code=n,r.feature.properties.Site_Name=l,r.feature.properties.Data_Type=e.options.name,c.datas[t]=r.feature.properties,i[n]=c})}),this._lookup=i,this.fire("init")})}static getSiteCode(e){return["Wid","WGNHS_ID","ID","Site_Code"].reduce((t,i)=>t||e[i],void 0)}getPoint(e){let t=null,i=this._lookup[f.getSiteCode(e)];return i&&(t=i.point),t}getSite(e){return this._lookup[f.getSiteCode(e)]}zoomToPoint(e){let t=this.getPoint(e);t&&this.map.setZoomAround(t.getLatLng(),15)}getHighlightPoint(){return this._highlight}setHighlightPoint(e){e?(this._highlight=e,this._highlight.bringToFront(),this._highlight.highlight()):this.clearSelection()}selectPoint(e){let t=null,i=this.getPoint(e);if(i){t=i.feature.properties,i!==this.getHighlightPoint()&&(this.clearSelection(),this.setHighlightPoint(i))}return t}selectSite(e){let t=this.getSite(e);return this.selectPoint(e),t}clearSelection(){this._highlight&&(this._highlight.bringToBack(),this._highlight.removeHighlight()),this._highlight=null}updatePoints(e){this.map.fire("filterpoints",{detail:{resolve:t=>e.reduce((e,i)=>{const o=f.getSiteCode(t),r=i.has(""+o);return e||r},!1)}})}setVisibility(e){e?(this.el.removeAttribute("data-closed"),this.map.invalidateSize()):this.el.setAttribute("data-closed",!0)}}class w extends t.LitElement{static get layoutName(){}static include(e,i){return t.html`<table-layout .info=${e} .context=${i}></table-layout>`}static get properties(){return{info:{type:Object},context:{type:Object}}}constructor(){super(),this.genId=(function(){const e={};return function(t){return e[t]||(e[t]=i.genId()),e[t]}})()}static get styles(){return t.css`[data-element=table]{display:grid;grid-template-columns:40% 1fr;grid-gap:var(--border-radius);margin:0 var(--border-radius)}.label{font-weight:var(--font-weight-bold)}`}render(){return t.html`<dl data-element=table>${Object.entries(this.info).filter(e=>!p.includes(e[0])).filter(e=>!!e[1]).map((e,i)=>t.html`<dt class=label title=${h[e[0]]?h[e[0]].desc:e[0]}><label for=${this.genId(i)}>${h[e[0]]?h[e[0]].title:e[0]}</label></dt><dd class=detail title=${h[e[0]]?h[e[0]].desc:e[0]}><span id=${this.genId(i)}>${e[1]}</span></dd>`)}</dl>`}}customElements.define("table-layout",w);const y=function(e,t,i,o,r){return(t=Math,i=t.log,o=1024,r=i(e)/i(o)|0,e/t.pow(o,r)).toFixed(2)+" "+(r?"KMGTPEZY"[--r]+"iB":"Bytes")};customElements.define("download-button",class extends t.LitElement{static get properties(){return{src:{type:String},exists:{type:Boolean,attribute:!1},fileSize:{type:String,attribute:!1}}}constructor(){super()}static get styles(){return[...i.styles,t.css`[data-closed]{display:none}.file-size{font-size:var(--font-size-small)}`]}render(){return t.html`<button-link href=${this.src} target=_blank download ?data-closed=${!this.exists}><i slot=content-before class=material-icons title=Download>save_alt</i> <span slot=content><slot>Download</slot></span><span slot=content-after class=file-size>${this.fileSize}</span></button-link>`}updated(e){e.has("src")&&this.src&&(this.exists=!1,fetch(this.src,{method:"HEAD"}).then(e=>{if(e.ok){this.exists=!0;let t=e.headers.get("Content-Length");t&&(this.fileSize=y(t))}}))}});class b extends t.LitElement{static get layoutName(){return"geophysical log"}static include(e,i){return t.html`<log-layout .info=${e} .context=${i}></log-layout>`}static get properties(){return{info:{type:Object},context:{type:Object}}}constructor(){super()}static get styles(){return t.css``}render(){return t.html`<table-layout .info=${this.prepInfo()} .context=${this.context}></table-layout><pdf-view-button .panel=${this.context.pdfpanel} src=${"https://data.wgnhs.wisc.edu/borehole-geophysics/pdf/"+this.info.Wid+".pdf"}><span slot=download-text>Download PDF</span></pdf-view-button><download-button src=${"https://data.wgnhs.wisc.edu/borehole-geophysics/las/"+this.info.Wid+".las"}>Download LAS</download-button>`}prepInfo(){return Object.assign(this.topFields,this.bottomFields)}get topFields(){return this.getFields(e=>!e.bundled)}get bottomFields(){const e=this.getFields(e=>e.bundled);return{"Data available:":Object.entries(e).filter(e=>!!e[1]).map(e=>h[e[0]]?h[e[0]].title:e[0]).map(e=>t.html`${e}<br>`)}}get group(){return g.find(e=>e.prop&&e[e.prop]===this.info[e.prop])}getFields(e){const t={};return this.group.sections.filter(e).forEach(e=>{Object.entries(e.fields).forEach(e=>{t[e[0]]=this.info[e[0]]})}),t}}customElements.define("log-layout",b);class v extends t.LitElement{static get layoutName(){return"quaternary core"}static include(e,i){return t.html`<core-layout .info=${e} .context=${i}></core-layout>`}static get properties(){return{info:{type:Object},context:{type:Object}}}constructor(){super()}static get styles(){return t.css``}render(){return t.html`<table-layout .info=${this.prepInfo()}></table-layout>`}prepInfo(){return Object.assign(this.topFields,this.bottomFields)}get topFields(){return this.getFields(e=>!e.bundled)}get bottomFields(){const e=this.getFields(e=>e.bundled);let i=Object.entries(e).filter(e=>!!e[1]).map(e=>h[e[0]]?h[e[0]].title:e[0]).map(e=>t.html`${e}<br>`);return i.length<1&&(i=null),{"Analyses available:":i}}get group(){return g.find(e=>e.prop&&e[e.prop]===this.info[e.prop])}getFields(e){const t={};return this.group.sections.filter(e).forEach(e=>{Object.entries(e.fields).forEach(e=>{t[e[0]]=this.info[e[0]]})}),t}}customElements.define("core-layout",v);const S=w,_=[S,b,v],x={getLayout:function(e){let t=_.find(t=>t.layoutName===e);return t||(t=S),t.include}};class $ extends t.LitElement{static get properties(){return{siteinfo:{type:Object},pdfpanel:{type:Object}}}constructor(){super()}static get styles(){return[...r.styles,t.css`.header{position:-webkit-sticky;position:sticky;top:0;background-color:var(--palette-white);padding:var(--font-size-extra-large) var(--border-radius);z-index:10;width:100%;box-sizing:border-box;display:flex;justify-content:space-between}.header h1{padding:0;max-width:70%;text-align:center}.header i{font-size:var(--icon-size-large);color:var(--palette-accent);cursor:pointer}.name{text-transform:capitalize}[data-closed]{display:none}`]}renderData(e,t){return x.getLayout(t)(e,this)}render(){let e=this.siteinfo?this.siteinfo.Latitude:null,i=this.siteinfo?this.siteinfo.Longitude:null,o=this.siteinfo?this.siteinfo.Wid:null;return t.html`${this.siteinfo?t.html`<div class=header><span><a href=${window.router.link("entry")} onclick=event.preventDefault()><i class="material-icons clear-selection" title="Clear selection" @click=${this.fireClearSelection}>arrow_back</i></a></span><h1>${this.siteinfo.Site_Name}</h1><span><i class="material-icons zoom-to-site" title="Zoom to site" @click=${this.fireZoomToSite}>my_location</i></span></div>${this.renderData({Latitude:e,Longitude:i,WID:o})} ${this.siteinfo.datas.map(e=>t.html`<app-collapsible open><span slot=header class=name>${e.Data_Type}</span><div slot=content>${this.renderData(e,e.Data_Type)}</div></app-collapsible>`)}`:""}`}fireClearSelection(){i.dispatch(this,"clear-selection",{},!0,!0)}fireZoomToSite(){i.dispatch(this,"zoom-to-site",{params:this.siteinfo},!0,!0)}}customElements.define("site-details",$);customElements.define("filter-summary",class extends t.LitElement{static get properties(){return{counts:{type:Array,attribute:!1}}}constructor(){super()}static get styles(){return t.css`li[disabled]{color:var(--palette-dark)}.name{text-transform:capitalize}`}render(){return this.counts?t.html`<div><span>Showing ${this.counts.reduce((e,t)=>t.current+e,0)} of ${this.counts.reduce((e,t)=>t.total+e,0)} total sites</span><ul>${this.counts.map(e=>t.html`<li ?disabled=${!e.included}>${e.current} of ${e.total} <span class=name>${e.name}</span> sites ${e.filteredBy.length>0?t.html`(filtered by ${e.filteredBy.join(", ")})`:""}</li>`)}</ul></div>`:t.html``}handleFiltered(e){e.detail&&(this.counts=e.detail.counts)}connectedCallback(){super.connectedCallback(),this.__filteredHandler=this.handleFiltered.bind(this),document.addEventListener("filtered",this.__filteredHandler)}disconnectedCallback(){document.removeEventListener("filtered",this.__filteredHandler),super.disconnectedCallback()}});class E extends t.LitElement{static get properties(){return{include:{type:Array,attribute:!1},filter:{type:Array,attribute:!1},matchClass:{type:String,attribute:!1},sources:{type:Array,attribute:!1}}}static get styles(){return[...r.styles,t.css`
      .field {
        display: grid;
        grid-template-columns: 40% 1fr;
        grid-gap: var(--border-radius);
        margin: 0 var(--border-radius);
      }

      .label {
        font-weight: var(--font-weight-bold);
      }

      .selector {
      }

      .section-title {
        margin: var(--line-height) 0 0 0;
        padding: var(--border-radius);
        background-color: var(--palette-light);
      }

      in-radio {
        display: inline-grid;
        grid-template-columns: auto auto;
      }
    `]}updateMatchClass(e){this.matchClass=e.target.choice}render(){return t.html`
      <div>
        Show sites that have <in-radio choices='["ALL", "ANY"]' @choice-change="${this.updateMatchClass}"></in-radio> of the following:
      </div>
      <div>
        ${this.renderFilterGroups()}
      </div>
    `}resolveKeyLookup(e){return h[e]?h[e].title:e}renderFilterGroups(){return this.filterGroups.map(e=>t.html`
      <app-collapsible
        ?open=${e.open} @open=${this._handle(e)}>
        <i slot="header-before" class="material-icons">expand_more</i>
        <span slot="header">${e.title}</span>
        ${e.toggleable?t.html`
          <toggle-switch
            name="${e.title}"
            slot="header-after"
            ?checked=${e.active}
            @change=${this._handleGroup(e,"include")}
            style="--palette-active: ${e.color}"
          ></toggle-switch>
        `:""}
        <div slot="content">
          ${e.sections.map((i,o)=>t.html`
            ${i.title?t.html`
              <h2 class="section-title">${i.title}</h2>
            `:""}
            ${Object.entries(i.fields).map((i,o)=>t.html`
              <div class="field">
              ${0===i[1].controls.length?"":i[1].controls.map(r=>t.html`
                <td class="label">
                  <label for="${this.genId(o)}" >
                    ${this.resolveKeyLookup(i[0])}
                  </label>
                </td>
                <td class="selector" 
                    @change="${this._handleControl(e,r,"filter")}">
                  <input
                    type="hidden"
                    id="${r.id}"
                    name="${i[0]}">
                  ${r.next}
                </td>
              `)}
              </div>
            `)}
          `)}
        </div>
      </app-collapsible>
    `)}get _eventHandlers(){return{open:(e,t)=>{e.open=t.detail.value}}}_handle(e){return t=>{const i=this._eventHandlers[t.type];i&&(i(e,t),this.requestUpdate("handle_"+t.type))}}_handleGroup(e,t){const i=e.id,o=e.activate.bind(e),r=this[t],s=this.requestUpdate.bind(this);return n=>{const l={};l.id=i,l.toggleable=e.toggleable,l.detail=n.detail,l.prop=e.prop,l.value=e[e.prop],D(r,i);let a=o(l);a&&r.push(a),s(t)}}_handleControl(e,t,i){const o=t.id,r=t.handle.bind(t),s=this[i],n=this.requestUpdate.bind(this);return t=>{const l={};l.id=o,l.group=e,l.target=t.currentTarget.querySelector("#"+o),l.prop=l.target.name,D(s,o);let a=r(l);a&&s.push(a),n(i)}}updated(e){const t=e.has("matchClass")||e.has("include")||e.has("filter")||e.has("sources");if(this.sources&&t){const e=E.runFilter({matchClass:this.matchClass,incl:this.include,filt:this.filter,sources:this.sources}),t=E.getResultsInfo(this.matchClass,this.include,this.filter,this.sources,e);i.dispatch(this,"filtered",{activePoints:e,counts:t},!0,!0)}}init(e,t){this.filterGroups.forEach(t=>{t.sections.forEach(t=>{Object.entries(t.fields).forEach(t=>{t[1].controls.forEach(i=>{i.init&&i.init(e[t[0]])})})})}),this.sources=t}static runFilter({matchClass:e,incl:t,filt:i,sources:o}){return o.map(o=>{const r=new Set;return Object.entries(o._layers).forEach(o=>{(function(o){let r=t.length>0&&t.reduce((e,t)=>e||t.resolve(o),!1),s=i.filter(e=>e.resolveGroup(o)),n=r&&s.length<1;return r&&!n&&(n="ALL"===e?s.reduce((e,t)=>e&&t.resolve(o),!0):s.reduce((e,t)=>e||t.resolve(o),!1)),n})(o[1].feature.properties)&&r.add(""+f.getSiteCode(o[1].feature.properties))}),r})}static getResultsInfo(e,t,i,o,r){return o.map((o,s)=>{let n={};n.name=o.options.name,n.included=t.some(e=>e.context.value===o.options.name),n.filteredBy=i.reduce((e,t)=>(t.context.group[t.context.group.prop]===o.options.name&&e.push(h[t.context.prop]?h[t.context.prop].title:t.context.prop),e),[]),n.matchClass=e;let l=Object.entries(o._layers);return n.total=l.length,n.current=r[s].size,n})}constructor(){super(),this.genId=(function(){const e={};return function(t){return e[t]||(e[t]=i.genId()),e[t]}})(),this.include=[],this.filter=[],this.filterGroups=g}}customElements.define("map-filter",E);const D=(e,t)=>{for(var i=e.findIndex(e=>e.id===t);i>=0;i=e.findIndex(e=>e.id===t))e.splice(i,1)};window.siteMap=new f,window.sidebar=document.querySelector("#sidebar"),window.pdfPanel=document.querySelector("#sketch"),document.querySelectorAll("site-details").forEach(function(e){e.pdfpanel=window.pdfPanel}),window.filter=document.querySelector("#filter"),window.siteMap.once("init",function(){window.siteData=new u(window.siteMap.layers),window.aggrData=siteData.aggrData,filter.init(window.siteData.uniques,window.siteMap.layers);var e=function(){window.pdfPanel.hide(),document.querySelectorAll("site-details").forEach(function(e){e.siteinfo=null})};async function t(t){return e(),document.querySelectorAll("site-details").forEach(function(e){e.siteinfo=t}),!0}window.router=new o.SiteRouter,window.router.addRoute({name:"entry",url:"/",onEnter:function(t,i){window.siteMap.clearSelection(),e(),document.querySelector("#app").setAttribute("data-view","app"),window.sidebar.switchTab("default"),window.siteMap.setVisibility(!0)},onExit:function(e,t){}}),window.router.addRoute({name:"view",url:"/view/:Site_Code",onEnter:function(e,i){let o=e.params(),r=window.siteMap.selectSite(o);r?(document.querySelectorAll("site-details").forEach(function(e){e.printLayout=!1}),t(r).then(()=>{document.querySelector("#app").setAttribute("data-view","app"),window.sidebar.switchTab("details"),window.siteMap.setVisibility(!0)})):window.router.clearRoute()},onExit:function(e,t){}}),window.router.addRoute({name:"print",url:"/print/:Site_Code",onEnter:function(e,i){let o=e.params(),r=window.siteMap.selectSite(o);r?(document.querySelectorAll("site-details").forEach(function(e){e.printLayout=!0}),t(r).then(()=>{document.querySelector("#app").removeAttribute("data-view"),window.sidebar.switchTab("details"),window.siteMap.setVisibility(!1)})):window.router.clearRoute()},onExit:function(e,t){}}),window.router.router.transitionService.onEnter({},()=>{document.querySelector("#spinner").setAttribute("data-closed",!0)}),window.router.start(),window.siteMap.on("interaction",e=>{e.Site_Code?window.router.setRoute("view",e):window.router.clearRoute()})}),document.addEventListener("clear-selection",function(e){window.router.clearRoute()}),document.addEventListener("zoom-to-site",function(e){window.siteMap.zoomToPoint(e.detail.params)}),document.addEventListener("toggle-print",function(e){e.detail.on?window.router.setRoute("print",e.detail.params):window.router.setRoute("view",e.detail.params)}),document.addEventListener("toggle-pdf-panel",function(e){window.siteMap.setVisibility(e.detail.closed),e.detail.closed?window.pdfPanel.setAttribute("data-closed",!0):window.pdfPanel.removeAttribute("data-closed")}),document.addEventListener("filtered",function(e){window.siteMap.updatePoints(e.detail.activePoints)}),e.MapFilter=E,e.SiteDetails=$,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.min.js.map
